import keras
import numpy as np


def load_model(model, weights):
	with open(model, 'r') as model_file:
		model = keras.models.model_from_json(model_file.read())
	model.load_weights(weights, by_name=False)
	return model

def make_1_prediction(input_list):
	model = load_model()
	input_array = np.array(input_list)
	prediction = model.predict(input_array.reshape((1,100))) #maybe not hardcoded?
	return prediction[0]

#input: array of text vectors (dim 100 x N)
#output: array of midi vector (dim 512 x N)
def make_mapping(mapping_model, mapping_weights, list_of_input_lists):
	model = load_model(mapping_model, mapping_weights)
	input_array = np.array(list_of_input_lists)
	predictions = model.predict(input_array.reshape(len(list_of_input_lists),100)) #maybe not hardcoded?
	return predictions

### example
# x = [-0.2775065302848816, -0.029162893071770668, -0.4678836166858673, 0.0820329561829567, -0.1820582002401352, 1.1049284934997559, 0.163174569606781, 0.5657333731651306, -1.1548495292663574, 0.04621781408786774, 0.08247119933366776, 0.4746231138706207, -0.02839774079620838, 0.09430026262998581, -0.4999479353427887, 0.21235601603984833, -0.5479164719581604, -0.15583261847496033, 0.3155294358730316, 0.21767018735408783, -1.024239182472229, 0.32000526785850525, -0.31005722284317017, 0.19598402082920074, -0.7253339886665344, -0.3904784023761749, -0.07016079872846603, 0.16425493359565735, -0.4288274347782135, 0.16207288205623627, -0.38813239336013794, -0.1000654324889183, 0.1427064836025238, 0.000987849198281765, -0.48480021953582764, -0.21622489392757416, -0.6399247646331787, -0.6544719934463501, 0.380193293094635, 0.13956603407859802, -0.12799595296382904, -0.3138750195503235, 0.12965668737888336, -0.9795591831207275, -0.26828232407569885, -0.06229653209447861, 0.25095173716545105, -0.7562238574028015, 0.1743193119764328, 0.0976848304271698, -0.20647907257080078, -0.19476309418678284, -0.34197860956192017, -0.05626427009701729, -0.8374115228652954, 0.2791599929332733, 0.2424902319908142, 0.2787505090236664, -0.005691733211278915, -0.07041874527931213, -0.048152100294828415, 0.4934677183628082, 0.12780040502548218, -0.2676902711391449, 0.4146907329559326, -0.32031863927841187, 0.04428725317120552, 0.31701937317848206, -0.34695231914520264, -0.7649867534637451, 0.38246074318885803, 0.6710696220397949, -0.30613091588020325, 0.24611972272396088, 0.5573678612709045, 0.18145862221717834, -0.9785500168800354, -0.023861324414610863, -0.06658908724784851, -0.09354736655950546, -0.6622669100761414, -0.37344589829444885, -0.37453627586364746, 0.2293727844953537, -0.1399000585079193, 0.5810501575469971, -0.4530361294746399, 0.2770594656467438, -0.26948919892311096, 0.6002812385559082, 0.14811599254608154, -0.17530769109725952, 0.26191627979278564, -0.16666898131370544, 0.10497046262025833, -0.3956737220287323, 0.8442036509513855, 0.3423524498939514, 0.5799452662467957, -0.1720483899116516]
# pred = make_1_prediction(x)